<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>뱃빛(햇빛) 그림자 시뮬레이션 — Boat Sun Shadow CAD</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans KR',sans-serif}
    #app{height:100vh;display:flex;}
    #canvasWrap{flex:1;position:relative}
    #ui{width:360px;padding:12px;background:#f7f7f8;border-left:1px solid #e6e6e6}
    label{display:block;margin:8px 0 4px;font-weight:600}
    button{margin-right:8px}
    #info{margin-top:12px;font-size:13px;color:#333}
    #credits{position:absolute;left:8px;bottom:8px;background:rgba(255,255,255,0.7);padding:6px;border-radius:6px;font-size:12px}
  </style>
</head>
<body>
  <div id="app">
    <div id="canvasWrap"></div>
    <div id="ui">
      <h3>뱃빛(햇빛) 그림자 시뮬레이션</h3>
      <p>시간(아침·점심·저녁)에 따라 햇빛(직사광) 위치와 그림자를 보여줍니다. 기본 위치: 서울(37.5665,126.9780).</p>

      <label>날짜</label>
      <input id="date" type="date" value="2025-09-10" />

      <label>시간 선택</label>
      <div>
        <button id="btnMorning">아침 (08:00)</button>
        <button id="btnNoon">점심 (12:00)</button>
        <button id="btnEvening">저녁 (18:00)</button>
      </div>

      <label>위치 (위도, 경도)</label>
      <div>
        <input id="lat" type="number" step="0.0001" value="37.5665" style="width:140px" />
        <input id="lon" type="number" step="0.0001" value="126.9780" style="width:140px" />
      </div>

      <label>그림자 강도</label>
      <input id="intensity" type="range" min="0" max="2" step="0.05" value="1" />

      <div id="info">
        <div>태양 방위각(Azimuth): <span id="azi">-</span></div>
        <div>태양 고도(Altitude): <span id="alt">-</span></div>
        <div>빛 방향 벡터: <span id="vec">-</span></div>
      </div>

      <div style="margin-top:12px;font-size:13px;color:#555">
        사용법: 날짜와 시간을 선택하면 장면에 햇빛이 바뀌고 그림자가 실시간으로 업데이트됩니다.
      </div>
    </div>
  </div>

  <div id="credits">Three.js + SunCalc</div>

  <!-- Three.js CDN -->
  <script src="https://unpkg.com/three@0.156.0/build/three.min.js"></script>
  <script src="https://unpkg.com/three@0.156.0/examples/js/controls/OrbitControls.js"></script>
  <!-- SunCalc for sun position calculations -->
  <script src="https://unpkg.com/suncalc@1.9.0/suncalc.js"></script>

  <script>
    const seoulOffset = 9; // 서울 UTC+9.
    const canvasWrap = document.getElementById('canvasWrap');
    const dateInput = document.getElementById('date');
    const latInput = document.getElementById('lat');
    const lonInput = document.getElementById('lon');
    const intensityInput = document.getElementById('intensity');
    const aziEl = document.getElementById('azi');
    const altEl = document.getElementById('alt');
    const vecEl = document.getElementById('vec');

    // Three.js 기본 씬
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0xeceff1);

    const renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(window.innerWidth - 360, window.innerHeight);
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.PCFSoftShadowMap;
    canvasWrap.appendChild(renderer.domElement);

    const camera = new THREE.PerspectiveCamera(45, (window.innerWidth-360)/window.innerHeight, 0.1, 2000);
    camera.position.set(10,8,12);

    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.target.set(0,0.7,0);
    controls.update();

    // 지면
    const groundGeo = new THREE.PlaneGeometry(100,100);
    const groundMat = new THREE.MeshStandardMaterial({color:0x9fc5e8, roughness:1, metalness:0});
    const ground = new THREE.Mesh(groundGeo, groundMat);
    ground.rotation.x = -Math.PI/2;
    ground.receiveShadow = true;
    scene.add(ground);

    // 물 느낌
    const water = new THREE.Mesh(new THREE.BoxGeometry(30,0.02,30), new THREE.MeshStandardMaterial({color:0x66aaff,transparent:true,opacity:0.6}));
    water.position.set(0,0.01,0);
    scene.add(water);

    // 배 모델
    const boat = new THREE.Group();
    const hullGeo = new THREE.BoxGeometry(3.6,0.6,1.4);
    hullGeo.translate(0, -0.2,0);
    const hullMat = new THREE.MeshStandardMaterial({color:0x8b4513, roughness:0.6});
    const hull = new THREE.Mesh(hullGeo, hullMat);
    hull.castShadow = true;
    hull.receiveShadow = true;

    const cabin = new THREE.Mesh(new THREE.BoxGeometry(1.2,0.7,0.9), new THREE.MeshStandardMaterial({color:0xffffff, roughness:0.7}));
    cabin.position.set(0.2,0.45,0);
    cabin.castShadow = true;

    boat.add(hull);
    boat.add(cabin);
    boat.position.set(0,0.35,0);
    scene.add(boat);

    const mast = new THREE.Mesh(new THREE.CylinderGeometry(0.03,0.03,2), new THREE.MeshStandardMaterial({color:0x333333}));
    mast.position.set(-0.9,1.35,0);
    mast.castShadow = true;
    boat.add(mast);

    const ambient = new THREE.AmbientLight(0xffffff, 0.25);
    scene.add(ambient);

    // 태양(DirectionalLight)
    const sun = new THREE.DirectionalLight(0xffffff, parseFloat(intensityInput.value));
    sun.castShadow = true;
    sun.shadow.mapSize.width = 2048;
    sun.shadow.mapSize.height = 2048;
    sun.shadow.camera.near = 0.5;
    sun.shadow.camera.far = 500;
    sun.shadow.camera.left = -30;
    sun.shadow.camera.right = 30;
    sun.shadow.camera.top = 30;
    sun.shadow.camera.bottom = -30;
    scene.add(sun);

    sun.target.position.set(0,0,0);
    scene.add(sun.target);

    const sunHelper = new THREE.DirectionalLightHelper(sun, 2, 0xff0000);
    scene.add(sunHelper);

    function getSeoulUTCDate(year, month, day, hour, minute=0){
      cons
